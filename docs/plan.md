# テトリス Web アプリ MVP 計画書（スマホファースト）

最小限で遊べる品質（MVP）を短期で公開する計画。追加要素は別マイルストーンに切り出し、スマホでの快適操作を最優先します。

## ゴール / 目的
- スマホ縦画面で片手でも快適に遊べる一般的なテトリス。
- 左: フィールド、右上: 次ミノ2個表示、右下: 操作ボタン（スマホ）。
- 60fps目標、カクつきや入力遅延なく気持ちよく遊べる。

## 対応プラットフォーム（MVP）
- スマホ: iOS Safari / Android Chrome（最優先）
- PC: Chrome/Edge/Safari/Firefox（基本動作 + キーボード操作）

## 画面レイアウト（共通）
- 左: フィールド（10×20 表示、上に隠し2行）。
- 右上: 次ミノキュー（2枠）。
- 右下: スマホ操作ボタン（左/右/下/回転の4つ）。

## MVP 仕様
### 盤面 / ミノ
- 盤面: 幅10 × 高さ20（表示）、隠し行2。
- ミノ: 一般的な7種（I, O, S, Z, J, L, T）。
- ランダマイザ: 7バッグ方式。
- 回転: SRS（壁蹴り含む）。
- 自動落下: 固定速度（MVPでは一定。追加で段階加速は次フェーズ）。
- ロックディレイ: 500ms を基本。着地中の移動/回転で延長可。

### 次ミノ表示
- 2つ先まで表示。ホールドはMVPでは未実装。

### スコアリング
- ライン消去: 1列=100、2列=300、3列=500、4列=800。
- ソフトドロップ/ハードドロップ: 加点なし（MVP）。
- ゲームオーバー: 天井到達で終了、スコア表示。

### 特殊ミノ（光る1マス）
- 仕様: たまに1ブロックが発光したミノが出現。
- 出現頻度: 5%（各スポーン時に判定）。
- 効果: そのピース設置直後の最初のライン消去イベントのスコアを2倍。
- スタック: なし（2倍固定）。
- 表示: ミノ内の1マスに発光エフェクト（簡易アニメ）。

### 操作
- スマホ（右下操作UI）
  - 左/右: 水平移動（長押しで連続移動: DAS 150ms / ARR 40ms 目安）。
  - 下: ソフトドロップ（押下中のみ、落下速度アップ）。
  - 回転: 右側の大ボタン。長押しで連続回転はしない。
- PC キーボード
  - ←/→: 水平移動（DAS/ARR同様の挙動）。
  - ↓: ソフトドロップ。
  - スペース: 右回転（ハードドロップはMVPでは未実装）。
  - P: 一時停止/再開。

### UI/演出
- ゴーストピース: OFF（MVP）※次フェーズ候補。
- 明滅/発光: 特殊ミノのみ簡易アニメ。
- サウンド: なし（MVP）。
- 設定: なし（MVP）。

### 非機能
- パフォーマンス: 60fps狙い、Canvas 2Dで差分描画。
- レスポンシブ: スマホ縦最適、横/PCでも破綻なし。
- アクセシビリティ: フォーカス可視、操作ボタンはタップ領域48px以上。

## 技術スタック
- 言語/ビルド: TypeScript + Vite。
- 描画: HTML Canvas 2D。
- 状態: 純TS（`Game`, `Board`, `Piece`, `Randomizer`, `Rules`, `Scoring`）。
- 入力: `Input`（キー/タッチ）、長押しタイマ（DAS/ARR）。
- データ永続化: なし（MVP）。

## アーキテクチャ
- Core: `Game`（ループ/状態遷移）, `Board`（衝突/固定/消去）, `Piece`（形/回転）, `Randomizer`, `Scoring`, `Rules`。
- Systems: `Gravity`, `LockDelay`, `LineClear`, `Spawner`。
- UI: `Renderer(Canvas)`, `NextQueueView`, `MobileControls`, `HUD(Score/State)`。

## ディレクトリ構成（案）
```
/ (root)
  ├─ docs/plan.md
  ├─ src/
  │   ├─ core/ (board, piece, game, rules, scoring, randomizer)
  │   ├─ systems/ (gravity, lock, line-clear, input)
  │   ├─ ui/ (renderer, controls, views)
  │   ├─ assets/ (images if any)
  │   └─ main.ts
  └─ index.html / styles.css
```

## マイルストーン（MVP）
- M1: コア完成（落下/回転/衝突/固定/消去/次ミノ2）。PC操作で遊べる。
- M2: スマホ操作UI（4ボタン/長押し/DAS/ARR）＋レイアウト最適化。
- M3: スコア/HUD/ポーズ/特殊ミノ（2倍）追加。基本最適化とバグ修正。

## 受け入れ基準（MVP）
- スマホ縦画面で片手で快適に操作できる（誤タップが少ない）。
- 次ミノ2つが常に視認できる。
- 特殊ミノがライン消去に関与した場合、スコアが2倍になる。
- 連続移動（長押し）が滑らかでカクつきがない。
- 20分程度の連続プレイでフリーズ/著しいフレーム落ちがない。

## 非MVP（次フェーズ候補）
- レベル制/速度上昇、ゴーストピース、ハードドロップ、ホールド。
- サウンド、テーマ切替、左利きUI、ハイスコア保存、PWA対応。

## 実装タスク（チェックリスト）
- [ ] Vite + TS 初期セットアップ、Canvas描画雛形。
- [ ] `Piece` 形定義/SRS回転/壁蹴り。
- [ ] `Board` 衝突/固定/行消去（10幅、隠し2行）。
- [ ] `Randomizer` 7バッグ、`Spawner` 実装、次ミノ2枠。
- [ ] `Gravity`/`LockDelay` ループ（60fps、500msロック）。
- [ ] PC入力（←/→/↓/Space）。
- [ ] スマホ操作UI（4ボタン、長押しDAS/ARR）。
- [ ] スコア/HUD、ゲームオーバー/リスタート。
- [ ] 特殊ミノ（5%/2倍/簡易発光）。
- [ ] 体感調整（速度/入力/当たり判定）と軽微バグ修正。

---
本計画は「全部任せる」「MVP最優先」に基づく初版です。変更希望があれば docs/plan.md を更新して反映します。
